# - name: 'Create {{ 1c_soft_path }}'
#   ansible.builtin.file:
#     path: "{{ 1c_soft_path }}"
#     state: directory
#     mode: '0755'
#   become: true

- name: Check timezone
  shell: timedatectl show --property=Timezone --value
  register: stdout_timedatectl

- name: Set timezone
  shell: timedatectl set-timezone Europe/Moscow
  become: true
  when: stdout_timedatectl.stdout != "Europe/Moscow"

- name: Установить нужные локали
  block:
    - name: Добавить необходимые локали в /etc/locale.gen (для Debian/Ubuntu)
      ansible.builtin.lineinfile:
        path: /etc/locale.gen
        regexp: "^#?({{ item }})"
        line: "{{ item }}"
        state: present
      loop: "{{ locales }}"
      become: true
      when: ansible_os_family == "Debian"

    - name: Добавить локали в /etc/locale.conf (для RedHat)
      ansible.builtin.lineinfile:
        path: /etc/locale.conf
        line: "{{ item }}"
        state: present
      loop: "{{ locales }}"
      become: true
      when: ansible_os_family == "RedHat"

    - name: Сгенерировать локали
      ansible.builtin.command: locale-gen "{{ item }}"
      loop: "{{ locales }}"
      become: true
      when: ansible_os_family == "Debian"

- name: Установить локаль по умолчанию
  block:
    - name: Обновить переменную LANG в /etc/default/locale (Debian/Ubuntu)
      ansible.builtin.lineinfile:
        path: /etc/default/locale
        regexp: "^LANG="
        line: "LANG={{ default_locale }}"
        create: yes
      become: true
      when: ansible_os_family == "Debian"

    - name: Обновить переменную LANG в /etc/locale.conf (RedHat)
      ansible.builtin.lineinfile:
        path: /etc/locale.conf
        regexp: "^LANG="
        line: "LANG={{ default_locale }}"
        create: yes
      become: true
      when: ansible_os_family == "RedHat"

- name: Показать все доступные локали
  shell: locale -a
  register: available_locales

- name: Показать локали по умолчанию
  shell: locale
  register: default_locales

- name: Вывести список всех доступных локалей
  debug:
    var: available_locales.stdout_lines

- name: Вывести локали по умолчанию
  debug:
    var: default_locales.stdout_lines

# - name: Refresh package lists
#   shell: sudo apt update && sudo apt dist-upgrade -y
#   become: true

- name: Debuig system info
  debug:
    msg: 
      - "Timezone {{ stdout_timedatectl.stdout }}"
      - "Accessible locale: {{ available_locales.stdout }}"
      - "Default locales: {{ default_locales.stdout }}"
  when: debug_status  == true

- name: Extract server64_8_3_23_2236.tar.gz
  ansible.builtin.unarchive:
    src: /tmp/1c_install_2v/server64_8_3_23_2236.tar.gz
    dest: /tmp/1c_install_2v/
    remote_src: yes